/**
 * Frontdesk Schedules Hook
 * Manages appointment rescheduling for frontdesk staff
 */

import { useState, useEffect } from "react";
import * as appointmentService from "@/services/appointmentService";
import { Appointment } from "@/services/appointmentService";

export const useFrontdeskSchedules = () => {
  const [appointments, setAppointments] = useState<Appointment[]>([]);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // Fetch all appointments
  const fetchAppointments = async () => {
    setIsLoading(true);
    setError(null);
    try {
      const data = await appointmentService.listAllAppointments();
      setAppointments(data);
    } catch (err) {
      const message = err instanceof Error ? err.message : "Failed to fetch";
      setError(message);
      console.error("Error fetching appointments:", err);
    } finally {
      setIsLoading(false);
    }
  };

  // Reschedule appointment
  const rescheduleAppointment = async (
    appointmentId: number,
    payload: appointmentService.CreateAppointmentRequest
  ) => {
    setIsLoading(true);
    setError(null);
    try {
      const updated = await appointmentService.rescheduleAppointment(
        appointmentId,
        payload
      );
      setAppointments((prev) =>
        prev.map((apt) => (apt.id === appointmentId ? updated : apt))
      );
      return updated;
    } catch (err) {
      const message = err instanceof Error ? err.message : "Failed to reschedule";
      setError(message);
      throw err;
    } finally {
      setIsLoading(false);
    }
  };

  // Fetch on mount
  useEffect(() => {
    fetchAppointments();
  }, []);

  return {
    appointments,
    isLoading,
    error,
    fetchAppointments,
    rescheduleAppointment,
  };
};